<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart</title>
    <style>
        *{
            padding: 0px;
            margin: 0px;
            font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            letter-spacing: 1px;
        }
        body{
            background-color: rgb(11, 7, 79);
            width: 100%;
            color: rgb(236, 233, 227);
        }
        section{
            width: 90%;
            margin: auto;
            display: flex;
        }

        .cardnumber{
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14x;
            font-weight: 600;
            top: 10px;
            right: 20px;
            width: 25px;
            height: 25px;
            color: white;
            background-color: red;
            border-radius: 50%;
            text-align: center;


        }
        .productsSection{
            width: 50%;
            background-color: rgb(30, 25, 112);
            padding: 10px;
            text-align: center;
        }
        .productsSection .contener{
            padding: 10px;
            width: 100%;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .productsSection .contener div{
            padding: 6px;
            border-radius: 6px;
            background-color: rgba(172, 171, 195, 0.4);
        }
        .bar img{
            width: 150px;

        }
        .tableCardsSction{
            width: 50%;
        }
        .tableCardsSction h1{
            text-align: center;
        }
        .tableCardsSction table{
            margin: 10px;
            width: 100%;
            font-size: 12px;
            font-weight: 200;
            border-collapse: collapse;
            padding: 4px;
            text-align: center;

        }
        .tableCardsSction table tr td, .tableCardsSction table tr th{
            border: 2px solid rgb(217, 193, 163,0.4);
            padding: 4px;
        }
        .tableCardsSction table tr td img{
            width: 40px;
            border-radius: 50%;
        }
        .deletproducts{
            color: white;
            cursor: pointer;
            border: none;
            border-radius: 6px;
            box-shadow: 0p 0px 10px white;
            padding: 4px;

            background-color: rgba(204, 7, 7);
        }

    </style>
</head>
<body>
    <section>
        <div class="cardnumber" id="cardnumber"></div>
        <div class="productsSection">
            <h1>Products</h1>
            <div class="contener" id="contener">
                <!-- product  JavaScript -->
            </div>
        </div>
        <div class="tableCardsSction">
            <h1>Table Products Cart</h1>
            <table>
                <thead>
                    <tr>
                        <th>Number</th>
                        <th>Image</th>
                        <th>Title</th>
                        <th>Price</th>
                        <th>Quantity</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody id="tableCard">
                    <!-- Items  here -->
                </tbody>
            </table>
            <h2>Total: <span id="totalPrice">0</span>$</h2>
        </div>
    </section>
    
    <script>

    const products = [
        { image: 'image/1.jpg', titel: 'Product 1', price: 99 },
        { image: 'image/2.jpg', titel: 'Product 2', price: 150 },
        { image: 'image/3.jpg', titel: 'Product 3', price: 99 }
    ];
    
    let cardindexshow = 0 ;
    
       

    // Function to create product 
    function displayProducts() {
        const container = document.getElementById('contener');
        products.forEach((product, index) => {
            const productDiv = document.createElement('div');
            productDiv.classList.add('bar');
            productDiv.innerHTML = `
                <img src="${product.image}" width="100%" alt="${product.titel}">
                <h2>${product.titel}</h2>
                <button onclick="AddTocard(${index})">Add to Cart</button>
            `;
            container.appendChild(productDiv);
        });
    }
    
    // Function to add a product to the cart
    function AddTocard(index) {
        let DataarrayCard;
        try {
            DataarrayCard = JSON.parse(localStorage.getItem("ProductsCard")) || [];
        } catch (error) {
            console.error('Failed to parse ProductsCard:', error);
            DataarrayCard = [];
        }
    
        const productToAdd = {
            image: products[index].image,
            titel: products[index].titel,
            price: products[index].price,
            quantity: 1 // Default quantity to 1 when added
        };
    
        // Check if the product is already in the cart and update quantity if so
        const existingProductIndex = DataarrayCard.findIndex(item => item.titel === productToAdd.titel);
        if (existingProductIndex > -1) {
            DataarrayCard[existingProductIndex].quantity += 1; // Increase quantity
        } else {
            DataarrayCard.push(productToAdd); // Add new product
        }
    
        localStorage.setItem("ProductsCard", JSON.stringify(DataarrayCard));
        showproductsCard();
    }
    
    // Function to display cart products in the table
    function showproductsCard() {
        const DataarrayCard = JSON.parse(localStorage.getItem("ProductsCard")) || [];
        const tableCard = document.getElementById('tableCard');
        const totalPriceElement = document.getElementById('totalPrice');
        tableCard.innerHTML = ''; // Clear existing content
        let total = 0;
    
        DataarrayCard.forEach((item, index) => {
        
            total += item.price * item.quantity; // Sum up total price
            if(index != 0){
                document.getElementById("cardnumber").innerText = `${index + 1}`;
            }else{
                document.getElementById("cardnumber").innerText = ` `;
            }
            document.getElementById("cardnumber").innerText = `${index + 1}`;
            tableCard.innerHTML += `
                <tr>
                    <td>${index + 1}</td>
                    <td><img src="${item.image}" alt="${item.titel}" width="50px"></td>
                    <td><h3>${item.titel}</h3></td>
                    <td><span>${item.price}</span>$</td>
                    <td>
                        <button onclick="decreaseQuantity(${index})">-</button>
                        <span>${item.quantity}</span>
                        <button onclick="increaseQuantity(${index})">+</button>
                    </td>
                    <td><button class="deletproducts" onclick="removeProduct(${index})">X</button></td>
                </tr>
            `;
        });
    
        totalPriceElement.textContent = total; // Display total price
    }
    
    // Function to remove a product from the cart
    function removeProduct(index) {
        let DataarrayCard = JSON.parse(localStorage.getItem("ProductsCard")) || [];
        DataarrayCard.splice(index, 1);
        localStorage.setItem("ProductsCard", JSON.stringify(DataarrayCard));
        showproductsCard();
    }
    
    // Function to increase product quantity
    function increaseQuantity(index) {
        let DataarrayCard = JSON.parse(localStorage.getItem("ProductsCard")) || [];
        DataarrayCard[index].quantity++; // Increase quantity by 1
        localStorage.setItem("ProductsCard", JSON.stringify(DataarrayCard));
        showproductsCard();
    }
    
    // Function to decrease product quantity
    function decreaseQuantity(index) {
        let DataarrayCard = JSON.parse(localStorage.getItem("ProductsCard")) || [];
        if (DataarrayCard[index].quantity > 1) {
            DataarrayCard[index].quantity--; // Decrease quantity by 1
        } else {
            DataarrayCard.splice(index, 1); // Remove product if quantity is 1
        }
        localStorage.setItem("ProductsCard", JSON.stringify(DataarrayCard));
        showproductsCard();
    }
    
    // Initialize the product display on page load
    window.onload = function() {
        displayProducts();
        showproductsCard();
    };
    </script>
    </body>
    </html>